# REST service

To run the project, follow the steps below. Docker with docker compose needs to be installed.

## Environment variables

Create `.env` file and define environment variables (example):

```env
PORT = 4000
POSTGRES_DB = api-dev
POSTGRES_PASSWORD = api2021
JWT_SECRET = EWSN870nN2F537jf0HpynxuornOqHXA8jYfE6anS
LOG_LEVEL = info
USE_FASTIFY = false
```

## Start server using docker

Create and run docker container:

```console
docker-compose up
```

Server should be up and running on 4000 port.

## Run migrations

Once server is up, execute migrations script in docker container:

```console
docker-compose run api yarn db:latest
```

## Install dependencies

Install project dependencies:

```console
npm i
```

## Run tests

Run auth tests using:

```console
npm run test:auth
```

## Lint project

Lint the project using:

```console
npm run lint
```

## Performance

Test app performance:

```console
npm run test:load
```

You can change duration, number of clients and other options in `artillery.yaml` file.

### Express

```
http.codes.200: ................................................................ 450
http.codes.201: ................................................................ 150
http.codes.204: ................................................................ 150
http.request_rate: ............................................................. 24/sec
http.requests: ................................................................. 750
http.response_time:
  min: ......................................................................... 1
  max: ......................................................................... 2365
  median: ...................................................................... 4
  p95: ......................................................................... 1901.1
  p99: ......................................................................... 2143.5
http.responses: ................................................................ 750
vusers.completed: .............................................................. 150
vusers.created: ................................................................ 150
vusers.created_by_name.Users crud: ............................................. 150
vusers.session_length:
  min: ......................................................................... 857.7
  max: ......................................................................... 4454.8
  median: ...................................................................... 2416.8
  p95: ......................................................................... 4147.4
  p99: ......................................................................... 4316.6
```

### Fastify

```
http.codes.200: ................................................................ 450
http.codes.201: ................................................................ 150
http.codes.204: ................................................................ 150
http.request_rate: ............................................................. 23/sec
http.requests: ................................................................. 750
http.response_time:
  min: ......................................................................... 0
  max: ......................................................................... 2589
  median: ...................................................................... 4
  p95: ......................................................................... 2101.1
  p99: ......................................................................... 2369
http.responses: ................................................................ 750
vusers.completed: .............................................................. 150
vusers.created: ................................................................ 150
vusers.created_by_name.Users crud: ............................................. 150
vusers.session_length:
  min: ......................................................................... 831.7
  max: ......................................................................... 4812.1
  median: ...................................................................... 2369
  p95: ......................................................................... 4492.8
  p99: ......................................................................... 4676.2
```
